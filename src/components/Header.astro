---
import { useTranslations, languages, getLocalizedPath, type Lang } from '@/i18n/translations';

interface Props {
  lang: Lang;
}

const { lang } = Astro.props;
const t = useTranslations(lang);
const BASE_URL = import.meta.env.BASE_URL || '/';
const base = BASE_URL.endsWith('/') ? BASE_URL.slice(0, -1) : BASE_URL;
const currentPath = Astro.url.pathname.replace(`${base}/${lang}`, '') || '/';

const navItems = [
  { href: '/', label: t('nav.home') },
  { href: '/services', label: t('nav.services') },
  { href: '/blog', label: t('nav.blog') },
  { href: '/about', label: t('nav.about') },
];
---

<header class="fixed w-full top-0 z-50 bg-white/95 backdrop-blur-sm shadow-sm">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href={getLocalizedPath('/', lang)} class="flex items-center gap-2">
        <svg class="w-10 h-8 text-primary-600" viewBox="0 0 100 65" fill="currentColor" stroke="currentColor">
          <line x1="50" y1="5" x2="50" y2="14" stroke-width="2.5" stroke-linecap="round"/>
          <line x1="32" y1="11" x2="37" y2="17" stroke-width="2.5" stroke-linecap="round"/>
          <line x1="68" y1="11" x2="63" y2="17" stroke-width="2.5" stroke-linecap="round"/>
          <line x1="20" y1="24" x2="27" y2="26" stroke-width="2.5" stroke-linecap="round"/>
          <line x1="80" y1="24" x2="73" y2="26" stroke-width="2.5" stroke-linecap="round"/>
          <path d="M32 40 A18 18 0 0 1 68 40" stroke="none"/>
          <path d="M8 55 Q3 52 5 47 Q8 42 16 40 Q30 52 50 52 Q70 52 84 40 Q92 42 95 47 Q97 52 92 55 Q72 58 50 58 Q28 58 8 55 Z" stroke="none"/>
        </svg>
        <span class="text-xl font-bold text-gray-900">Kayak Tigre</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center gap-8">
        {navItems.map((item) => (
          <a
            href={getLocalizedPath(item.href, lang)}
            class={`text-sm font-medium transition-colors hover:text-primary-600 ${
              currentPath === item.href ? 'text-primary-600' : 'text-gray-700'
            }`}
          >
            {item.label}
          </a>
        ))}
      </div>

      <!-- Language Switcher & CTA -->
      <div class="flex items-center gap-4">
        <!-- Language Dropdown -->
        <div class="relative group">
          <button class="flex items-center gap-1 text-sm font-medium text-gray-700 hover:text-primary-600">
            {lang.toUpperCase()}
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div class="absolute right-0 mt-2 w-32 bg-white rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
            {Object.entries(languages).map(([code, name]) => (
              <a
                href={`${base}/${code}${currentPath}`}
                class={`block px-4 py-2 text-sm hover:bg-gray-50 ${
                  code === lang ? 'text-primary-600 font-medium' : 'text-gray-700'
                }`}
              >
                {name}
              </a>
            ))}
          </div>
        </div>

        <!-- CTA Button -->
        <a
          href={getLocalizedPath('/services', lang)}
          class="hidden sm:inline-flex items-center px-4 py-2 bg-primary-600 text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors"
        >
          {t('services.book')}
        </a>

        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="md:hidden p-2 text-gray-700">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4 border-t border-gray-100">
      <div class="flex flex-col gap-2 pt-4">
        {navItems.map((item) => (
          <a
            href={getLocalizedPath(item.href, lang)}
            class={`px-4 py-2 text-sm font-medium rounded-lg ${
              currentPath === item.href
                ? 'bg-primary-50 text-primary-600'
                : 'text-gray-700 hover:bg-gray-50'
            }`}
          >
            {item.label}
          </a>
        ))}
        <div class="flex gap-2 px-4 pt-2 border-t border-gray-100 mt-2">
          {Object.entries(languages).map(([code, name]) => (
            <a
              href={`${base}/${code}${currentPath}`}
              class={`px-3 py-1 text-sm rounded ${
                code === lang
                  ? 'bg-primary-600 text-white'
                  : 'bg-gray-100 text-gray-700'
              }`}
            >
              {code.toUpperCase()}
            </a>
          ))}
        </div>
      </div>
    </div>
  </nav>
</header>

<script>
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');

  menuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });
</script>
